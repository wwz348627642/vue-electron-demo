webpackJsonp([20],{157:function(e,t,n){"use strict";function a(e,t,n,a,o,s,u,c,i,l,d){var _=e.USER,m=e.PROJECT,f=m.project_path;e.loading_label=!0,e.project_params={username:m.owner_user_name,project_name:m.name},e.view=n.id?"detail":"list",e.tasks_count={done:0,processing:0},e.tasks_total_count=0,e.inner_menu=n.region,e.shouldMemberActive="user"===n.region,e.task_user=n.user||_.global_key,e.task_label_id=n.user||0,e.task_user_name_map=null,e.username=n.username,e.project_name=n.project_name,e.user_task_status=n.status||"all",e.task_id=n.id||0,e.members=[],e.searchMember="";var p=[];e.$on("project.task.tag.selected",function(t,n){e.task_label_id=n.id,e.inner_menu="label",e.task_user=null});var k=function(e,t){return c.orderMembers(e,t.id)};e.isActive=function(t){return e.inner_menu==t&&"list"===e.view};var v=function(){return o.count({id:m.id},function(t){e.tasks_count=t.data})},g=function(){var t=o.countOfUser({id:m.id});return t.then(function(t){var n=t.data;r.forEach(e.members,function(e){var t=s.findOfId(n,e.user_id,"user");e.count=t?r.copy(t):{processing:0,done:0,user:e.user_id}})}),t},h=u.members({id:m.id}),b=h.then(function(t){var n=t.data&&t.data.list||[];return e.members=k(n,_),a(function(){$(".search-member").enableArrowkeySelect({listSelector:".member",textSelector:".name.ellipsis span:first-child"})},0),e.task_user_name_map={},r.forEach(e.members,function(t){var n=t.user.global_key;e.task_user_name_map[n]=t.user.name}),o.countOfUser({id:m.id})});b.then(function(t){var n=t.data;r.forEach(e.members,function(e){var t=s.findOfId(n,e.user_id,"user");e.count=t?r.copy(t):{processing:0,done:0,user:e.user_id}})}),e.loadTasks=function(n,a,r){e.task_label_id=null,t.$broadcast("load.task.list",n,a,r);var o=f+"/tasks/"+n;a&&(o+="/"+a),a&&r&&(o+="/"+r),"list"===e.view?i.skipReload().path(o):i.path(o),e.inner_menu=n,e.task_user=a||"",e.user_task_status=r};var j=function(t){for(var n in e.members){var a=e.members[n];if(a.user.global_key==t)return a}},w=function(t,n){var a=[v(),g(),S()];d.all(a).then(function(){var n={all:function(){return e.tasks_count.processing+e.tasks_count.done},done:function(){return e.tasks_count.done},processing:function(){return e.tasks_count.processing},watch:function(){return e.tasks_count.watch},create:function(){return e.tasks_count.create},user:function(){var t=j(e.task_user);return t.count.processing+t.count.done}};e.tasks_total_count=s.smartSwitch(n,e.inner_menu,t),l.changeCount("list",e.tasks_total_count)})};r.forEach(["update.owner","update.status","update.watch","remove","add","update.label","watcher.remove","watcher.add"],function(e){var t=c.onProjectTaskSignal(e,function(t,n){w(n,e)});p.push(t)}),e.$on("goto.task.detail",function(n,a){var r=[t.PROJECT.project_path,"task",a.id,a.just_show_comment?"comment":""].join("/");i.search(""),i.skipReload().path(r),e.view="detail",e.task_id=a.id}),l.onCountChange("index",function(t,n){e.tasks_total_count=n}),e.tags=[],e.$on("project.tag.create",function(){S()}),e.$on("project.tag.remove",function(){S()}),e.$on("project.tag.add",function(){S()}),e.$on("project.tag.updated",function(){S()});var S=function(){e.loading_label=!0;var t=o.tags(e.project_params);return t.then(function(t){e.tags=t.data||[],a(function(){$(".search-tags").enableArrowkeySelect({listSelector:".tag-item",textSelector:".tag-description"})},0),e.loading_label=!1}),t};v(),S(),e.$on("$destroy",function(){p.map(function(e){r.isFunction(e)&&e()})})}var r=n(1);e.exports=r.module("task.controller.index",[]).controller("TaskController",a),a.$inject=["$scope","$rootScope","$routeParams","$timeout","Task","Common","Project","TaskItemService","location","TaskListService","$q"]},158:function(e,t,n){"use strict";var a=n(1);e.exports=a.module("task",[n(157).name])}});